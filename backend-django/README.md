# Auto Photo Saver Backend

Django backend with WebSocket support for the Auto Photo Saver app.

## Features

- Django REST API for photo management
- WebSocket support using Django Channels
- Real-time photo notifications
- File upload and storage
- CORS support for Flutter frontend

## Local Development

1. Install dependencies:

```bash
pip install -r requirements.txt
```

2. Run migrations:

```bash
python manage.py migrate
```

3. Start the development server:

```bash
python manage.py runserver
```

4. For WebSocket support, use Daphne:

```bash
daphne backend.asgi:application --port 8000 --bind 0.0.0.0
```

## Deployment to Render

### Option 1: Using render.yaml (Recommended)

1. Push your code to GitHub
2. Connect your repository to Render
3. Render will automatically detect the `render.yaml` file and deploy

### Option 2: Manual Deployment

1. Create a new Web Service on Render
2. Connect your GitHub repository
3. Configure the following settings:
   - **Build Command**: `./build.sh`
   - **Start Command**: `daphne backend.asgi:application --port $PORT --bind 0.0.0.0`
   - **Environment**: Python 3.12.3

### Environment Variables

Set these environment variables in Render:

- `SECRET_KEY`: Django secret key (auto-generated by render.yaml)
- `DEBUG`: Set to "False" for production
- `PYTHON_VERSION`: 3.12.3

## API Endpoints

- `GET /api/photos/latest/` - Get the latest photo
- `POST /api/photos/upload/` - Upload a new photo
- `WS /ws/photo/` - WebSocket endpoint for real-time updates

## WebSocket Events

When a new photo is uploaded, the WebSocket sends:
```json
{
  "type": "photo_update",
  "image": {
    "id": 1,
    "image": "https://example.com/media/photo.jpg",
    "original_file_name": "photo.jpg",
    "file_size": 1024,
    "uploaded_at": "2024-01-01T12:00:00Z"
  }
}
```

## File Structure

```
backend-django/
├── backend/
│   ├── asgi.py          # ASGI configuration for WebSocket
│   ├── settings.py      # Django settings
│   ├── urls.py          # URL routing
│   └── routing.py       # WebSocket routing
├── photo/
│   ├── consumers.py     # WebSocket consumers
│   ├── models.py        # Photo model
│   └── views.py         # API views
├── requirements.txt     # Python dependencies
├── build.sh            # Build script for Render
├── render.yaml         # Render deployment config
└── README.md           # This file
``` 